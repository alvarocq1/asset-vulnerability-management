CREATE TABLE IF NOT EXISTS assets (
    ip_address VARCHAR(15) PRIMARY KEY,
    os VARCHAR(255),
    hostname VARCHAR(255)
);

CREATE TABLE IF NOT EXISTS scan_tasks (
    task_id VARCHAR(36) PRIMARY KEY,
    ip_address VARCHAR(15),
    FOREIGN KEY (ip_address) REFERENCES assets(ip_address)
);

CREATE TABLE IF NOT EXISTS scan_results (
    result_id VARCHAR(255) PRIMARY KEY,
    task_id VARCHAR(36),
    name TEXT,
    ip_address VARCHAR(15),
    port VARCHAR(20),
    cvss FLOAT,
    qod VARCHAR(5),
    nvt_oid VARCHAR(50),
    nvt_family TEXT,
    cves TEXT,
    solution_type TEXT,
    cvss_type VARCHAR(20),
    cvss_vector VARCHAR(50),
    correlation_risk FLOAT,
    exploitability VARCHAR(1),
    description TEXT, 
    solution TEXT,
    FOREIGN KEY (ip_address) REFERENCES assets(ip_address),
    FOREIGN KEY (task_id) REFERENCES scan_tasks(task_id)
);

CREATE TABLE IF NOT EXISTS scan_metadata (
    scan_id SERIAL PRIMARY KEY,
    task_id VARCHAR(36) UNIQUE,
    ip_address VARCHAR(15),
    start_time TIMESTAMP,
    end_time TIMESTAMP,
    scan_time INTERVAL NOT NULL,
    FOREIGN KEY (task_id) REFERENCES scan_tasks(task_id),
    FOREIGN KEY (ip_address) REFERENCES assets(ip_address)
);
