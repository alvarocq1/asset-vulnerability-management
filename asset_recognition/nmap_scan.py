import nmap
import psycopg2

def scan_network():
    nm = nmap.PortScanner()
    nm.scan(hosts='192.168.1.0/24', arguments='-sP')
    return nm.all_hosts()

def store_assets(assets):
    conn = psycopg2.connect(
        dbname="tfg_db",
        user="acarriq",
        password="3432576",
        host="localhost",
        port="5432"
    )
    cur = conn.cursor()
    for asset in assets:
        cur.execute("INSERT INTO assets (ip_address) VALUES (%s) ON CONFLICT (ip_address) DO NOTHING;", (asset,))
    conn.commit()
    cur.close()
    conn.close()

if __name__ == "__main__":
    assets = scan_network()
    store_assets(assets)
    print("Assets scanned and stored successfully.")
