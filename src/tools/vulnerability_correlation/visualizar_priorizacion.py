import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import numpy as np

# Leer el archivo CSV generado
df = pd.read_csv('src/data/vulnerabilidades_priorizadas.csv')

# Configuración de estilo para seaborn
sns.set(style="whitegrid")

# Añadir jittering a los datos
df['cvss_jittered'] = df['cvss'] + np.random.normal(0, 0.1, len(df))
df['correlation_risk_jittered'] = df['correlation_risk'] + np.random.normal(0, 0.1, len(df))

# Crear la figura y los ejes explícitamente
fig, ax = plt.subplots(figsize=(12, 8))
scatter = sns.scatterplot(data=df, x='cvss_jittered', y='correlation_risk_jittered', hue='cvss_diff', size='cvss_diff', sizes=(40, 400), palette='viridis', alpha=0.7, ax=ax)

# Añadir etiquetas y título
ax.set_xlabel('CVSS Score')
ax.set_ylabel('Correlation Risk')
ax.set_title('Relación entre CVSS y Correlation Risk con CVSS Diff')

# Añadir barra de color
norm = plt.Normalize(df['cvss_diff'].min(), df['cvss_diff'].max())
sm = plt.cm.ScalarMappable(cmap="viridis", norm=norm)
sm.set_array([])
fig.colorbar(sm, ax=ax, label='CVSS Diff')

# Guardar el gráfico como una imagen
plt.savefig('src/figures/relacion_cvss_correlation_risk.png')
plt.close()  # Cerrar la figura en lugar de mostrarla
