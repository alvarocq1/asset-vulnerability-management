<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Asset Vulnerability Management{% endblock %}</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script>
        function updateTime() {
            var now = new Date();
            var formattedTime = now.getFullYear() + '-' + 
                                ('0' + (now.getMonth() + 1)).slice(-2) + '-' + 
                                ('0' + now.getDate()).slice(-2) + ' ' + 
                                ('0' + now.getHours()).slice(-2) + ':' + 
                                ('0' + now.getMinutes()).slice(-2) + ':' + 
                                ('0' + now.getSeconds()).slice(-2);
            document.getElementById('currentTime').textContent = formattedTime;
        }

        function updateStatus() {
            fetch('/check_status')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('openvas_status').textContent = data.openvas_status ? '✅' : '❌';
                    document.getElementById('db_status').textContent = data.db_status ? '✅' : '❌';
                    localStorage.setItem('openvas_status', data.openvas_status ? '✅' : '❌');
                    localStorage.setItem('db_status', data.db_status ? '✅' : '❌');
                })
                .catch(error => console.error('Error fetching status:', error));
        }

        function loadStatus() {
            var openvasStatus = localStorage.getItem('openvas_status') || '❌';
            var dbStatus = localStorage.getItem('db_status') || '❌';
            document.getElementById('openvas_status').textContent = openvasStatus;
            document.getElementById('db_status').textContent = dbStatus;
        }

        setInterval(updateTime, 1000); // Actualiza la hora cada segundo
        window.onload = function() {
            updateTime();
            loadStatus(); // Cargar el estado desde localStorage
            setTimeout(updateStatus, 1000); // Verificar una vez después de 1 segundo
            setInterval(updateStatus, 20000); // Actualiza el estado cada 20 segundos
        };
    </script>
</head>
<body>
    <div class="sidebar">
        <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" class="logo">
        <h2>Menu</h2>
        <ul>
            <li><a href="{{ url_for('index') }}">Inicio</a></li>
            <li><a href="{{ url_for('show_assets') }}">Mostrar Activos</a></li>          
            <li><a href="{{ url_for('analysis') }}">Análisis</a></li>
        </ul>
        <div class="status">
            <p>OpenVAS Status: <span id="openvas_status">❌</span></p>
            <p>DataBase Status: <span id="db_status">❌</span></p>
        </div>
    </div>
    <div class="main-content">
        <div class="header">
            <p id="currentTime"></p>
        </div>
        <div class="content">
            {% block content %}{% endblock %}
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
</body>
</html>
