<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Asset Vulnerability Management{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script>
        function updateTime() {
            var now = new Date();
            var formattedTime = now.getFullYear() + '-' + 
                                ('0' + (now.getMonth() + 1)).slice(-2) + '-' + 
                                ('0' + now.getDate()).slice(-2) + ' ' + 
                                ('0' + now.getHours()).slice(-2) + ':' + 
                                ('0' + now.getMinutes()).slice(-2) + ':' + 
                                ('0' + now.getSeconds()).slice(-2);
            document.getElementById('currentTime').textContent = formattedTime;
        }

        setInterval(updateTime, 1000); // Actualiza la hora cada segundo
        window.onload = updateTime; // Actualiza la hora al cargar la página

        function updateStatus() {
            fetch('/check_status')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('openvas_status').textContent = data.openvas_status ? '✅' : '❌';
                    document.getElementById('db_status').textContent = data.db_status ? '✅' : '❌';
                })
                .catch(error => console.error('Error fetching status:', error));
        }

        window.onload = function() {
            updateTime();
            updateStatus(); // Verificar inmediatamente después de cargar la página
            setInterval(updateStatus, 20000); // Actualiza el estado cada 20 segundos
        };
    </script>
</head>
<body>
    <div class="sidebar">
        <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" class="logo">
        <h2>Menu</h2>
        <ul>
            <li><a href="{{ url_for('index') }}">Inicio</a></li>
            <li><a href="{{ url_for('run_pipeline') }}">Iniciar Pipeline</a></li>
            <li><a href="{{ url_for('show_cves') }}">Mostrar CVEs</a></li>
            <li><a href="{{ url_for('show_assets') }}">Mostrar Activos</a></li>
            <li><a href="{{ url_for('correlation_analysis') }}">Análisis de Correlación</a></li>
        </ul>
        <div class="status">
            <p>OpenVAS Connection: <span id="openvas_status">{% if openvas_status %}✔️{% else %}❌{% endif %}</span></p>
            <p>PostgreSQL Connection: <span id="db_status">{% if db_status %}✔️{% else %}❌{% endif %}</span></p>
        </div>
    </div>
    <div class="main-content">
        <div class="header">
            <p id="currentTime"></p>
        </div>
        <div class="content">
            {% block content %}{% endblock %}
        </div>
    </div>
</body>
</html>
