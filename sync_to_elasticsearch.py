import psycopg2
from elasticsearch import Elasticsearch, helpers

# Configuración de PostgreSQL
conn = psycopg2.connect(
    dbname="tfg_db",
    user="acarriq",
    password="3432576",
    host="localhost",
    port="5432"
)

# Configuración de Elasticsearch
es = Elasticsearch(["http://localhost:9200"])

def fetch_assets():
    cur = conn.cursor()
    cur.execute("SELECT ip_address, os_info FROM assets")
    rows = cur.fetchall()
    cur.close()
    return rows

def index_assets(assets):
    actions = [
        {
            "_index": "assets",
            "_id": asset[0],
            "_source": {
                "ip_address": asset[0],
                "os_info": asset[1]
            }
        }
        for asset in assets
    ]
    helpers.bulk(es, actions)

if __name__ == "__main__":
    assets = fetch_assets()
    index_assets(assets)
    print("Assets indexed in Elasticsearch successfully.")
