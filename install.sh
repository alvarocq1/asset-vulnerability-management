#!/bin/bash

# Crear y activar el entorno virtual
python3 -m venv ProjectEnv
source ProjectEnv/bin/activate

# Instalar dependencias de Python
pip install -r requirements.txt

# Detectar el sistema operativo
OS=$(uname)

if [[ "$OS" == "Linux" ]]; then
    echo "Sistema operativo detectado: Linux"

    # Instalar nmap en Linux
    sudo apt-get update
    sudo apt-get install -y nmap

    # Instalar PostgreSQL en Linux
    sudo apt-get install -y postgresql postgresql-contrib

    # Iniciar el servicio de PostgreSQL en Linux
    sudo systemctl start postgresql
    sudo systemctl enable postgresql

    # Instalar Metasploit en Linux
    curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb > msfinstall
    chmod 755 msfinstall
    sudo ./msfinstall

elif [[ "$OS" == "Darwin" ]]; then
    echo "Sistema operativo detectado: macOS"

    # Instalar nmap en macOS
    brew update
    brew install nmap

    # Instalar PostgreSQL en macOS
    brew install postgresql

    # Iniciar el servicio de PostgreSQL en macOS
    brew services start postgresql

    # Instalar Metasploit en macOS
    curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb > msfinstall
    chmod 755 msfinstall
    sudo ./msfinstall
else
    echo "Sistema operativo no soportado: $OS"
    exit 1
fi

# Configurar e inicializar la base de datos
sudo -u postgres psql -f init.sql

echo "Instalaci√≥n completada. No olvides configurar tu archivo .env con las credenciales necesarias."
