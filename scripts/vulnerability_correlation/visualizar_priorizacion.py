import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# Leer el archivo CSV generado
df = pd.read_csv('./data/vulnerabilidades_priorizadas.csv')

# Configuración de estilo para seaborn
sns.set(style="whitegrid")

# Crear un gráfico de dispersión para visualizar la relación entre CVSS y Correlation Risk
plt.figure(figsize=(12, 8))
scatter = sns.scatterplot(data=df, x='cvss', y='correlation_risk', hue='cvss_diff', size='cvss_diff', sizes=(40, 400), palette='viridis', legend=None)

# Añadir etiquetas y título
plt.xlabel('CVSS Score')
plt.ylabel('Correlation Risk')
plt.title('Relación entre CVSS Score y Correlation Risk')

# Guardar el gráfico como una imagen
plt.savefig('./visualizations/relacion_cvss_correlation_risk.png')
plt.close()  # Cerrar la figura en lugar de mostrarla

# Crear un gráfico de barras para comparar las diferencias
df_sorted = df.sort_values(by='cvss_diff', ascending=False)
plt.figure(figsize=(14, 10))
barplot = sns.barplot(data=df_sorted, x='cvss_diff', y='cve', hue='cvss_diff', palette='coolwarm', dodge=False, legend=False)

# Añadir etiquetas y título
plt.xlabel('Difference between Correlation Risk and CVSS')
plt.ylabel('CVE ID')
plt.title('Prioritización de Vulnerabilidades basada en la Diferencia entre Correlation Risk y CVSS')

# Guardar el gráfico como una imagen
plt.savefig('./visualizations/priorizacion_vulnerabilidades.png')
plt.close()  # Cerrar la figura en lugar de mostrarla
